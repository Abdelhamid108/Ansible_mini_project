#!/bin/bash
# Application deployment script for Node.js applications
# Generated by Ansible - do not edit manually

{% for app in apps_configs %}
# Deployment section for {{ app.name }}
sudo -i -u myappuser npm install --prefix "{{ app.app_path }}" || true
sudo -i -u myappuser npm audit --prefix "{{ app.app_path }}" || true
sudo -i -u myappuser npm audit fix --prefix "{{ app.app_path }}" || true

sudo -i -u myappuser pm2 delete "{{ app.name }}" || true

sudo -i -u myappuser pm2 start "{{ app.script_path }}"  --name "{{ app.name }}"  --watch
{% endfor %}

# PM2 Process Management Configuration
sudo -i -u myappuser pm2 save
sudo -i -u myappuser pm2 startup systemd -u myappuser
sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u myappuser --hp /home/myappuser
